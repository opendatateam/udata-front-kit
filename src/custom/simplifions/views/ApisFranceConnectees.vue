<template>
  <div class="fr-container fr-mt-4w">
    <h1>Les APIs FranceConnect√©es</h1>

    <div class="fr-grid-row fr-grid-row--gutters">
      <div class="fr-col-12 fr-col-lg-8">
        <p class="fr-text--lead">
          Les API FranceConnect√©es donnent acc√®s √† diverses donn√©es
          administratives des particuliers en proposant FranceConnect comme
          modalit√© d'appel.
        </p>
        <p class="fr-mb-4w fr-text--lg">
          Elles permettent de simplifier les d√©marches d'un particulier
          utilisant FranceConnect en r√©cup√©rant automatiquement d'autres
          informations administratives le concernant.
        </p>
      </div>

      <div class="fr-col-12 fr-col-lg-4">
        <nav
          class="fr-summary"
          role="navigation"
          aria-labelledby="fr-summary-title"
        >
          <ol>
            <li>
              <a id="summary-link-2" class="fr-summary__link" href="#definition"
                >D√©finition</a
              >
            </li>
            <li>
              <a id="summary-link-2" class="fr-summary__link" href="#acteurs"
                >Acteurs</a
              >
            </li>
            <li>
              <a
                id="summary-link-2"
                class="fr-summary__link"
                href="#possibilite-de-simplification"
                >Possibilit√©s de simplification</a
              >
            </li>
            <li>
              <a
                id="summary-link-2"
                class="fr-summary__link"
                href="#liste-des-api-franceconnectees"
                >Liste des API FranceConnect√©es</a
              >
            </li>
          </ol>
        </nav>
      </div>
    </div>

    <h2
      id="definition"
      class="fr-h2 fr-my-0w fr-mt-4w"
      style="
        color: black;
        background-color: rgb(167, 212, 205);
        padding: 2px 4px;
        display: inline-block;
      "
    >
      D√©finition
    </h2>

    <p class="fr-text--lead" style="text-align: center">
      Dans l'administration, on parle d'<i>¬´&nbsp;API FranceConnect√©e&nbsp;¬ª</i>
      :
    </p>

    <div
      class="fr-grid-row fr-grid-row--gutters fr-ml-8w fr-mr-8w fr-mb-4w fr-grid-row--top"
    >
      <div class="fr-col-12 fr-col-md-6">
        <p class="fr-text--lead fr-text--bold" style="text-align: center">
          Lorsqu'une API est interrog√©e via le bouton FranceConnect ...
        </p>
        <figure role="group" class="fr-content-media fr-content-media--sm">
          <div class="fr-content-media__img">
            <img
              class="fr-responsive-img"
              src="/static/simplifions/assets/api-franceconnectees-bouton-france-connect.png"
              alt=""
              style="width: auto; height: 100%"
            />
          </div>
        </figure>
        <p class="fr-text--lg">
          Les API FranceConnect√©es permettent d'<b
            >utiliser l'identit√© pivot fournie par
            <a target="_blank" href="https://franceconnect.gouv.fr/partenaires"
              >FranceConnect</a
            >
            comme modalit√© d'appel.</b
          >
        </p>
      </div>
      <div class="fr-col-12 fr-col-md-6">
        <p class="fr-text--lead fr-text--bold" style="text-align: center">
          ... et lorsqu'elle d√©livre des donn√©es administratives des
          particuliers.
        </p>
        <figure role="group" class="fr-content-media fr-content-media--sm">
          <div class="fr-content-media__img">
            <img
              class="fr-responsive-img"
              src="/static/simplifions/assets/api-franceconnectees-donnees-personnelles.png"
              alt=""
              style="width: auto; height: 100%"
            />
          </div>
        </figure>
        <p class="fr-text--lg">
          Elles permettent de
          <b>transmettre des donn√©es administratives personnelles du citoyen</b
          >.
        </p>
      </div>

      <div class="fr-col-12">
        <p class="fr-text--lg">
          Selon le cadre d'utilisation, elles proposent √©galement de
          <b>r√©cup√©rer l'identit√© pivot utilis√©e et fournie par FranceConnect</b
          >.
        </p>
      </div>
    </div>

    <h2
      id="acteurs"
      class="fr-h2 fr-my-0w fr-mt-4w"
      style="
        color: black;
        background-color: rgb(167, 212, 205);
        padding: 2px 4px;
        display: inline-block;
      "
    >
      Les acteurs des API FranceConnect√©es
    </h2>

    <h3 class="fr-h4">FranceConnect et les fournisseurs d'identit√© :</h3>

    <p>
      Lors de l'int√©gration d'une API FranceConnect√©e dans votre service, il est
      pr√©-requis d'int√©grer la
      <a href="/solutions/franceconnect-2">solution FranceConnect</a> car le
      bouton "FranceConnect" sera la modalit√© d'appel utilis√©e par l'API pour
      renvoyer les donn√©es √† l'usager.
    </p>

    <p>
      En proposant le bouton FranceConnect sur votre service, vous permettez √†
      vos usagers d'utiliser le <i>fournisseur d'identit√©</i> qu'il souhaitent
      pour s'authentifier (impots.gouv.fr, ameli.fr, l'Identit√© Num√©rique La
      Poste, etc.).
    </p>

    <blockquote class="fr-highlight">
      <p>
        üí¨ <strong>R√¥le de FranceConnect :</strong><br />
        FranceConnect est votre interlocuteur pour int√©grer le bouton
        FranceConnect, de l'habilitation √† l'homologation, en passant par
        l'int√©gration. Par contre FranceConnect n'est pas en mesure de r√©pondre
        √† vos questions sur les donn√©es distribu√©es via les API
        FranceConnect√©es.
        <br /><br />
        üí¨ <strong>R√¥le des fournisseurs d'identit√© :</strong><br />
        Les fournisseurs d'identit√© ne seront jamais vos interlocuteurs. En
        int√©grant FranceConnect, tous les fournisseurs d'identit√© seront
        propos√©s √† vos usagers quand ils cliqueront sur le bouton FranceConnect.
      </p>
    </blockquote>

    <h3 class="fr-h4">Les fournisseurs de donn√©es :</h3>
    <p>
      Diff√©rentes administrations mettent √† disposition, apr√®s habilitation et
      via des API FranceConnect√©es, les donn√©es administratives des particuliers
      dont elles ont la charge. Dans l'univers des API FranceConnect√©es, ces
      administrations sont nomm√©es <i>fournisseurs de donn√©es</i>.
    </p>

    <p>
      <b>En voici la liste :</b> Caisse nationale des allocations familiales
      (CNAF), Direction de la S√©curit√© sociale, Direction g√©n√©rale des finances
      publiques (DGFIP), France Travail, Minist√®re de l'Enseignement sup√©rieur
      et de la Recherche, Minist√®re de l'√âducation nationale et Cnous.
    </p>

    <blockquote class="fr-highlight">
      <p>
        üí¨ <strong>R√¥le des fournisseurs d'identit√© :</strong><br />
        Les fournisseurs de donn√©es sont vos interlocuteurs concernant la
        d√©livrance des acc√®s, l'int√©gration et la maintenance des API
        FranceConnect√©es. C'est eux qui sont en mesure de r√©pondre √† vos
        questions concernant les donn√©es distribu√©es et le fonctionnement des
        API qu'ils op√®rent.
        <br />
        <i>Si vous utilisez l'API Particulier</i>, ce service sera votre
        interlocuteur unique.
      </p>
    </blockquote>

    <p>
      <b>Afin de simplifier l'int√©gration des API FranceConnect√©es</b>, la
      <a href="/solutions/bouquet-api-particulier">solution API Particulier</a>
      regroupe dans un m√™me bouquet d'API une grande partie des API
      FranceConnect√©es.
    </p>

    <blockquote class="fr-highlight">
      <p>
        üí¨ <strong>R√¥le de l'API Particulier :</strong><br />
        Si vous acc√©dez aux API FranceConnect√©es via ce bouquet d'API, API
        Particulier est votre interlocuteur unique pour l'habilitation,
        l'int√©gration et la maintenance des API FranceConnect√©es du bouquet. API
        Particulier est en mesure de r√©pondre √† vos questions concernant les
        donn√©es distribu√©es et le fonctionnement des API qu'il propose. En cas
        de difficult√©, API Particulier se charge des √©changes avec les
        fournisseurs de donn√©es.
      </p>
    </blockquote>

    <h2
      id="possibilite-de-simplification"
      class="fr-h2 fr-my-0w fr-mt-4w"
      style="
        color: black;
        background-color: rgb(167, 212, 205);
        padding: 2px 4px;
        display: inline-block;
      "
    >
      Possibilit√©s de simplification
    </h2>

    <p class="fr-text--lead">
      Voici un comparatif entre une API appel√©e via une modalit√© d'appel
      classique <i>identifiant ou √©tat civil</i> et une API appel√©e en mode
      "FranceConnect√©e", c'est-√†-dire via l'identit√© pivot FranceConnect :
    </p>

    <table class="fr-table">
      <thead>
        <tr>
          <th></th>
          <th style="width: 40%">
            Modalit√© d'appel<br />Identit√© pivot ou Identifiant
          </th>
          <th style="width: 40%">Modalit√© d'appel<br />FranceConnect</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>√âtapes du parcours de l'usager</strong></td>
          <td>
            <ol>
              <li>
                L'usager se connecte via son compte personnel authentifi√© ou via
                FranceConnect ;
              </li>
              <li>
                Au cours de sa d√©marche, il recherche les informations
                n√©cessaires pour permettre l'appel aux API ne proposant pas la
                modalit√© d'appel FranConnect ; comme par exemple son num√©ro
                fiscal, son √©tat civil ou son identifiant FranceTravail ;
              </li>
              <li>Il saisit ces informations ;</li>
              <li>
                Sa d√©marche est compl√©t√©e des donn√©es r√©cup√©r√©es via les API.
              </li>
            </ol>
          </td>
          <td>
            <ol>
              <li>L'usager se connecte via FranceConnect ;</li>
              <li>
                La d√©marche est d√©j√† pr√©-remplie des informations r√©cup√©r√©es via
                les API.
              </li>
            </ol>
          </td>
        </tr>
        <tr>
          <td><strong>Authentification de l'usager</strong></td>
          <td>‚ùå √Ä v√©rifier par vos agents</td>
          <td>‚úÖ Comprise avec la connexion</td>
        </tr>
        <tr>
          <td>
            <strong
              >D√©livrance instantan√©e de donn√©es administratives compl√©mentaires
              issues des API FranceConnect√©es</strong
            >
          </td>
          <td>
            ‚ùå Uniquement apr√®s v√©rification de l'identit√© de l'internaute par
            vos agents
          </td>
          <td>‚úÖ Oui</td>
        </tr>
        <tr>
          <td>
            <strong
              >Moins de donn√©es personnelles dans votre syst√®me
              d'information</strong
            >
          </td>
          <td>
            ‚ùå Les donn√©es personnelles renseign√©es par l'usager pour appeler
            l'API transitent par votre syst√®me d'information
          </td>
          <td>
            ‚úÖ Il est possible de choisir que l'identit√© pivot ne transite pas
            par votre syst√®me d'information
          </td>
        </tr>
        <tr>
          <td><strong>P√©rim√®tre des usagers couverts</strong></td>
          <td>‚úÖ La totalit√©</td>
          <td>‚ö†Ô∏è Seulement les usagers ayant FranceConnect</td>
        </tr>
      </tbody>
    </table>

    <h2
      id="liste-des-api-franceconnectees"
      class="fr-h2 fr-my-0w fr-mt-4w"
      style="
        color: black;
        background-color: rgb(167, 212, 205);
        padding: 2px 4px;
        display: inline-block;
      "
    >
      Liste des API FranceConnect√©es
    </h2>

    <p class="fr-text--lead">
      Voici la liste des API pouvant √™tre requ√™t√©es via un token FranceConnect :
    </p>

    <div v-if="apisLoading" class="fr-mt-4w">
      <p>Chargement des APIs en cours...</p>
    </div>

    <div v-else-if="apisFranceConnectees.length === 0" class="fr-mt-4w">
      <p>Aucune API FranceConnect√©e trouv√©e.</p>
    </div>

    <ul v-else class="fr-grid-row fr-grid-row--gutters list-none">
      <li
        v-for="apiOrDataset in apisFranceConnectees"
        :key="apiOrDataset.UID_datagouv"
        class="fr-col-12 fr-py-0 fr-mt-4w fr-px-0"
      >
        <SimplifionsDataApi :api-or-dataset="apiOrDataset" />
      </li>
    </ul>
  </div>
</template>

<script setup lang="ts">
import SimplifionsDataApi from '../components/SimplifionsDataApi.vue'
import { grist } from '../grist'
import type { ApiOrDataset } from '../model/grist'

const apisLoading = ref(true)
const apisFranceConnectees = ref<ApiOrDataset[]>([])

grist
  .getRecords('APIs_et_datasets', { API_FranceConnectee: [true] })
  .then((data) => {
    apisFranceConnectees.value = (
      data.map((record) => record.fields) as ApiOrDataset[]
    ).filter(
      (apiOrDataset) =>
        apiOrDataset.Visible_sur_simplifions && apiOrDataset.Type === 'API'
    )
    apisLoading.value = false
  })
  .catch((error) => {
    console.error('Failed to fetch APIs FranceConnect√©es:', error)
    apisLoading.value = false
  })
</script>

<style scoped>
.list-none {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>
